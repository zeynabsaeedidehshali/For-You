<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>üíñ Happy Birthday, My Love</title>
<style>
  :root{
    --rose:#ffd6f0; --orchid:#f5c2ff; --lilac:#d8b4fe;
    --ink1:#511041; --ink2:#6c2a5e; --ink3:#5b1c51;
    --glass: rgba(255,255,255,.78);
    --glass-border: rgba(255,255,255,.9);
    --shadow: 0 16px 44px rgba(91,28,81,.16), 0 3px 12px rgba(91,28,81,.10);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; overflow:hidden; touch-action: manipulation;
    display:grid; place-items:center;
    background:
      radial-gradient(1200px 800px at 20% -10%, rgba(245,194,255,.32), transparent 60%),
      radial-gradient(1000px 700px at 120% 120%, rgba(216,180,254,.32), transparent 60%),
      linear-gradient(180deg, var(--rose), var(--orchid) 50%, var(--lilac));
    font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji", emoji, sans-serif;
  }
  body::after{ content:""; position:fixed; inset:0; pointer-events:none;
    background: radial-gradient(60% 60% at 50% 50%, rgba(0,0,0,0) 0 60%, rgba(0,0,0,.08) 100%); z-index:0;
  }
  canvas.bg-layer{ position:fixed; inset:0; pointer-events:none; z-index:0; }

  .content{ position:relative; z-index:2; display:flex; flex-direction:column; align-items:center; gap:16px; padding:10px; width:min(1100px, 96vw); }
  .text-box{
    background: linear-gradient(180deg, var(--glass), rgba(255,255,255,.62));
    -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
    border: 1px solid var(--glass-border);
    border-radius: 24px; box-shadow: var(--shadow);
    padding: clamp(16px, 4vw, 28px); text-align:center;
  }
  h1{
    font-size: clamp(32px,7.2vw,74px); margin:0;
    background: linear-gradient(135deg, #b76cff, #ff7ab6);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow: 0 2px 14px rgba(255,118,182,.25);
  }
  .emoji{ font-family:"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",emoji; vertical-align:-.08em; }
  p.lead{ font-size: clamp(18px,4vw,28px); margin:10px 0 14px; color:var(--ink2); }
  #msg{ font-size: clamp(20px,4.5vw,32px); color:var(--ink3); opacity:0; transform:translateY(10px); transition:opacity .5s ease, transform .5s ease; }
  #msg.show{ opacity:1; transform:translateY(0) }
  #heartBtn{ font-size: clamp(58px,14vw,130px); cursor:pointer; user-select:none;
    filter: drop-shadow(0 10px 26px rgba(183,108,255,.26));
    animation: pulse 1.6s ease-in-out infinite, float 4.5s ease-in-out infinite;
  }
  @keyframes pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.13)} }
  @keyframes float{ 0%,100%{ translate:0 0 } 50%{ translate:0 -6px } }
</style>
</head>
<body>
  <canvas id="bg" class="bg-layer"></canvas>
  <canvas id="confetti" class="bg-layer"></canvas>

  <div class="content" aria-live="polite">
    <div id="heartBtn" aria-label="Heart" class="emoji">üíó</div>
    <div class="text-box">
      <h1>Happy Birthday, my love <span class="emoji">üíó</span></h1>
      <p class="lead">My heart beats happiest with you <span class="emoji">üíï</span></p>
      <div id="msg">I love you more than all the stars <span class="emoji">‚ú®</span>, all the songs <span class="emoji">üé∂</span>, and every heartbeat <span class="emoji">‚ù§Ô∏è</span>. Happy Birthday, my forever. <span class="emoji">üíïüíúüíòüòò</span></div>
    </div>
  </div>

<script>
// ---- Adaptive performance & mobile safety ----
const ua = navigator.userAgent;
const isIOS = /iP(hone|ad|od)/i.test(ua);
const isAndroid = /Android/i.test(ua);
const isMobile = isIOS || isAndroid;
const DPR_CAP = isIOS ? 1.0 : 1.3; // keep low on iOS Safari to prevent reloads
const DPR = Math.min(DPR_CAP, window.devicePixelRatio || 1);
let running = true;
document.addEventListener('visibilitychange', () => { running = !document.hidden; });

// ---- Emoji glyph cache with limited size ----
const EMOJIS = ["‚ù§Ô∏è","üíñ","üíú","üíï","üíò","üíû","üòò","üòö","üòô","üòó","‚òÅÔ∏è","üå•Ô∏è","üå§Ô∏è","üåô","‚≠ê","‚ú®","üåü"];
const glyphCache = new Map();
const CACHE_LIMIT = 64;
function makeEmojiCanvas(char, size){
  const c = document.createElement('canvas');
  const pad = Math.ceil(size*0.35);
  c.width = c.height = (size + pad*2);
  const g = c.getContext('2d');
  g.textAlign = 'center'; g.textBaseline = 'middle';
  g.font = size + 'px "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",emoji, serif';
  g.fillText(char, c.width/2, c.height/2);
  return c;
}
function getGlyph(char, size){
  const key = char + '@' + Math.round(size);
  if(!glyphCache.has(key)){
    if(glyphCache.size > CACHE_LIMIT){ // simple eviction: clear oldest
      const firstKey = glyphCache.keys().next().value;
      glyphCache.delete(firstKey);
    }
    glyphCache.set(key, makeEmojiCanvas(char, Math.round(size)));
  }
  return glyphCache.get(key);
}

// ---- Canvas sizing helpers (cap dimensions to reduce memory) ----
function capSize(w,h,max=1400){
  const scale = Math.min(1, max/Math.max(w,h));
  return [Math.floor(w*scale), Math.floor(h*scale)];
}

// ---- Background tunnel ----
const bg = document.getElementById('bg');
const ctx = bg.getContext('2d');
let W=0,H=0,cx=0,cy=0;
function resizeBG(){
  let w = innerWidth, h = innerHeight;
  [w,h] = capSize(w,h, 1280); // cap to 1280 px canvas
  bg.style.width = innerWidth + 'px'; bg.style.height = innerHeight + 'px';
  bg.width = Math.floor(w * DPR); bg.height = Math.floor(h * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
  W=w; H=h; cx=W/2; cy=H/2;
}
resizeBG(); addEventListener('resize',resizeBG, {passive:true});

let sprites = [];
let SPRITE_COUNT = isMobile ? 60 : 110; // fewer sprites
function resetSprite(s){
  s.angle=Math.random()*Math.PI*2;
  s.radius=0.35+Math.random()*1;
  s.z=1+Math.random()*3.2;
  s.char=EMOJIS[(Math.random()*EMOJIS.length)|0];
  s.size=(isMobile?16:18)+Math.random()*24;
  s.spin=(Math.random()<.5?-1:1)*(0.0011+Math.random()*0.0032);
  s.speed=(isMobile?0.011:0.009)+Math.random()*0.015;
  return s;
}
for(let i=0;i<SPRITE_COUNT;i++){ sprites.push(resetSprite({})); }

let last = performance.now();
function loopBG(now){
  if(!running){ requestAnimationFrame(loopBG); return; }
  // Adaptive load shedding: if frame took too long, temporarily drop sprites
  const dt = now - last; last = now;
  if(dt > 28 && SPRITE_COUNT > (isMobile?40:80)){ sprites.length = SPRITE_COUNT -= 2; }
  ctx.clearRect(0,0,W,H);
  for(const s of sprites){
    s.angle+=s.spin; s.z-=s.speed;
    if(s.z<=0.05) resetSprite(s), s.z=3.2;
    const tubeR=Math.min(W,H)*0.44;
    const k=tubeR*s.radius/s.z;
    const x=cx+Math.cos(s.angle)*k;
    const y=cy+Math.sin(s.angle)*k;
    const size=s.size*(1.5/s.z);
    const glyph = getGlyph(s.char, size);
    ctx.drawImage(glyph, x - glyph.width/2, y - glyph.height/2);
  }
  requestAnimationFrame(loopBG);
}
requestAnimationFrame(loopBG);

// ---- Confetti (touch pops) ----
const conf=document.getElementById('confetti');
const c2=conf.getContext('2d');
let W2=0,H2=0;
function resizeC(){
  let w = innerWidth, h = innerHeight;
  [w,h] = capSize(w,h, 1280);
  conf.style.width = innerWidth + 'px'; conf.style.height = innerHeight + 'px';
  conf.width = Math.floor(w * DPR); conf.height = Math.floor(h * DPR);
  c2.setTransform(DPR,0,0,DPR,0,0);
  W2=w; H2=h;
}
resizeC(); addEventListener('resize',resizeC, {passive:true});

let pieces=[];
let MAX_PIECES = isMobile ? 300 : 600;
function addConfetti(n=80, origin={x:innerWidth/2,y:innerHeight/2}){
  const count = isMobile ? Math.floor(n*0.7) : n;
  for(let i=0;i<count;i++){
    const char = EMOJIS[(Math.random()*EMOJIS.length)|0];
    pieces.push({x:origin.x,y:origin.y,
      vx:(Math.random()*2-1)*5.8, vy:(Math.random()*-1-1)*6.6,
      g:0.19+Math.random()*0.08,
      char,
      size:(isMobile?20:22)+Math.random()*24,
      life:(isMobile?110:140)+Math.random()*110
    });
  }
  if(pieces.length > MAX_PIECES) pieces.splice(0, pieces.length - MAX_PIECES);
}
function loopConfetti(){
  if(!running){ requestAnimationFrame(loopConfetti); return; }
  c2.clearRect(0,0,W2,H2);
  pieces=pieces.filter(p=>(p.life-=1)>0 && p.y<H2+40);
  for(const p of pieces){
    p.vy+=p.g; p.x+=p.vx; p.y+=p.vy;
    const glyph = getGlyph(p.char, p.size);
    c2.drawImage(glyph, p.x - glyph.width/2, p.y - glyph.height/2);
  }
  requestAnimationFrame(loopConfetti);
}
requestAnimationFrame(loopConfetti);

// ---- Interaction (tap + swipe) ----
const btn=document.getElementById('heartBtn');
const msg=document.getElementById('msg');
function popAt(x,y,scale=1){ addConfetti(Math.round((isMobile?56:80)*scale), {x,y}); }
btn.addEventListener('click',()=>{ msg.classList.add('show'); popAt(innerWidth/2, innerHeight/2.05, 2.0); }, {passive:true});
document.addEventListener('click',e=>{ if(e.target===btn) return; popAt(e.clientX, e.clientY, 1); }, {passive:true});
let touching=false, lastPop=0;
document.addEventListener('pointerdown', e=>{ touching=true; popAt(e.clientX, e.clientY, 1.1); }, {passive:true});
document.addEventListener('pointermove', e=>{
  if(!touching) return;
  const now = performance.now();
  if(now - lastPop > 80){ lastPop = now; popAt(e.clientX, e.clientY, 0.55); }
}, {passive:true});
document.addEventListener('pointerup', ()=>{ touching=false; }, {passive:true});
document.addEventListener('pointercancel', ()=>{ touching=false; }, {passive:true});

// gentle intro
setTimeout(()=> popAt(innerWidth/2, innerHeight/1.18, 1.0), 650);
</script>
</body>
</html>
